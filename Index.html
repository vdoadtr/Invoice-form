<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice Form</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f0f0;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 2rem;
            min-height: 100vh;
        }

        /* The container for the invoice form is set to A4 dimensions (210mm x 297mm) */
        .a4-container {
            width: 210mm;
            min-height: 297mm;
            background-color: white;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            padding: 0;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* The main content area that will grow to fill the available space */
        .invoice-content {
            padding: 1.5rem;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        
        .top-image {
            width: 100%;
            height: auto;
            max-height: 50mm;
            object-fit: contain;
        }

        .bottom-image {
            width: 100%;
            height: auto;
            max-height: 38mm;
            object-fit: contain;
        }

        .edit-panel {
            width: 300px;
            background-color: white;
            padding: 1rem;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-right: 2rem;
            position: sticky;
            top: 2rem;
        }

        .edit-panel input, .edit-panel select {
            width: 100%;
            margin-top: 0.25rem;
            margin-bottom: 0.75rem;
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.25rem;
        }
        
        .checkbox-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 0.5rem;
        }
        
        .print-button {
            margin-top: 1.5rem;
            background-color: #3b82f6;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: bold;
            cursor: pointer;
            text-align: center;
            width: 100%;
        }
        
        .add-customer-button {
            background-color: #10b981;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin-top: 0.5rem;
        }
        
        #customerList {
            margin-top: 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.25rem;
            padding: 0.5rem;
            max-height: 150px;
            overflow-y: auto;
        }
        
        .customer-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem;
            background-color: #f3f4f6;
            margin-bottom: 0.5rem;
            border-radius: 0.25rem;
            transition: background-color 0.2s;
            cursor: pointer;
        }
        
        .customer-item:hover {
            background-color: #e5e7eb;
        }

        .customer-item .delete-btn {
            color: #ef4444;
            font-weight: bold;
            cursor: pointer;
            padding: 0 0.5rem;
        }
        
        /* New merged bottom section styles, now using flexbox for print stability */
        .bottom-section {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: auto; 
            position: relative;
        }

        /* This container now aligns the stamp and signature, linking their positions */
        .merged-elements {
            width: 100%;
            display: flex;
            justify-content: flex-end; /* Changed to flex-end to push the signature to the right */
            align-items: flex-end;
            padding: 0 1.5rem;
            margin-top: 0;
            padding-top: 2px;
        }

        /* Container for the stamp, centered within its flex-grow space */
        .stamp-container {
            display: flex;
            justify-content: center;
            flex-grow: 1;
            /* Make sure the stamp container doesn't shrink, so it can stay centered */
            flex-shrink: 0;
        }
        
        .stamp-image {
            width: 25mm; 
            height: auto;
            object-fit: contain;
        }

        .signature-section {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        /* A more robust layout for the top section, avoiding absolute positioning */
        .top-image-container {
            position: relative;
        }
        
        .money-receipt-text {
            position: absolute;
            bottom: 0;
            right: 1.5rem;
            transform: translateY(50%);
            /* Updated font-family for 'MONEY RECEIPT' text */
            font-family: 'Arial Black', sans-serif;
            /* Updated color for 'MONEY RECEIPT' text */
            color: #6e0808;
        }

        /*
        * A custom class for the dedicated blank space for names
        */
        .customer-names-display {
            /* This div now uses flex-grow to fill all available space */
            flex-grow: 1;
            overflow-y: auto;
            border: 1px solid #d1d5db;
            padding: 0.5rem;
            margin-top: 0.25rem;
            /* New grid layout for two columns */
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        /*
        * New style for the watermark image, using an <img> tag for better control
        */
        .watermark-image {
            position: absolute;
            top: 56%; /* Adjusted from 58% to 56% to move it up slightly */
            left: 50%;
            transform: translate(-50%, -50%);
            max-width: 65%; 
            height: auto;
            opacity: 0.1;
            z-index: 0;
            object-fit: contain;
        }
        
        /* The container for the dynamic email input in the edit panel */
        .email-input-container {
            display: flex;
            align-items: center;
            width: 100%;
            margin-top: 0.25rem;
            margin-bottom: 0.75rem;
            padding: 0.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.25rem;
            background-color: #f9fafb;
        }

        /* Styles for the dynamic part of the email input */
        .email-input-container input {
            padding: 0; /* Remove padding here to control it on the container */
            border: none;
            flex: 1; /* Allow input to grow */
            background-color: transparent;
            margin-bottom: 0; /* Override the default margin-bottom */
        }
        
        /* Styles for the static '@gmail.com' text */
        .email-input-container span {
            color: #4b5563; /* Gray text color */
            margin-left: 0.25rem; /* Small space between input and text */
            font-size: 0.875rem;
        }

        /* @media print query to fix the mobile printing issue */
        @media print {
            /* Set the page size to A4 and remove all margins forcefully */
            @page {
                size: A4;
                margin: 0 !important;
            }

            /* Hiding the edit panel and print button */
            .edit-panel, .print-button {
                display: none !important;
            }

            /* Forcing a white background and no margins on the body */
            body {
                background-color: #fff !important;
                margin: 0 !important;
                padding: 0 !important;
                /* This is a crucial fix for mobile, it forces the content to be the size of the viewport */
                width: 100vw !important;
                height: 100vh !important;
            }

            /* Reseting the container styles to fit A4 page without any overflow */
            .a4-container {
                box-shadow: none !important;
                border: none !important;
                margin: 0 !important;
                padding: 0 !important;
                /* To make it work on both desktop and mobile, we use a combination of units */
                width: 100% !important;
                min-height: 100vh !important;
            }
            
            /* Adjusting content padding for a better fit */
            .invoice-content {
                padding: 1rem !important;
            }
            
            .bottom-section {
                margin-top: 0 !important;
            }
            
            .merged-elements {
                /* Reset margin in print view for predictable spacing */
                margin-top: 0 !important; 
                padding-top: 2px !important; /* Also update print view */
            }

            /* This is the fix for the background color not printing, forcing the browser to print colors */
            .grid-header {
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
            
            /* Ensure text wraps to prevent overflow */
            .grid > div {
                overflow-wrap: break-word;
            }
            
            /* Remove the dashed border in print view for a clean look */
            .customer-names-display {
                border-style: solid !important; /* Change to solid or none if you prefer */
                border-color: transparent !important; /* Make the border invisible */
            }
        }
        
        /* Special styles for mobile view to handle the long text without wrapping badly */
        @media (max-width: 768px) {
            .top-image-container {
                position: static;
                display: flex;
                flex-direction: column;
                align-items: center;
                text-align: center;
                padding-top: 1rem;
            }
            .money-receipt-text {
                position: static;
                transform: none;
                margin-top: 0.5rem;
            }
            .a4-container {
                width: 100%;
                min-height: auto;
                box-shadow: none;
            }
            body {
                padding: 0.5rem;
            }
            .edit-panel {
                width: 100%;
                margin-right: 0;
            }
        }
        
        /* New style for focus state on checkboxes, making them more visible */
        .payment-checkbox:focus {
            outline: none;
            box-shadow: 0 0 0 2px #3b82f6, 0 0 0 4px #bfdbfe;
        }
    </style>
</head>
<body class="bg-gray-100 flex p-8">

    <!-- Edit Panel -->
    <div class="edit-panel">
        <h2 class="text-xl font-bold mb-4">Edit Panel</h2>
        <div class="mb-2">
            <label class="block text-gray-700 font-bold mb-1">Name:</label>
            <input type="text" id="nameInput" placeholder="Type Name">
        </div>
        <div class="mb-2">
            <label class="block text-gray-700 font-bold mb-1">Phone:</label>
            <input type="text" id="phoneInput" placeholder="Type Phone Number">
        </div>
        <div class="mb-2">
            <label class="block text-gray-700 font-bold mb-1">Email:</label>
            <!-- Updated Email Input to pre-fill @gmail.com -->
            <div class="email-input-container">
                <input type="text" id="emailPrefixInput" placeholder="Type Email Prefix">
                <span>@gmail.com</span>
            </div>
            <!-- END: Updated Email Input -->
        </div>
        <div class="mb-2">
            <label class="block text-gray-700 font-bold mb-1">Address:</label>
            <input type="text" id="addressInput" placeholder="Type Address">
        </div>
        <div class="mb-2">
            <label class="block text-gray-700 font-bold mb-1">Invoice No:</label>
            <input type="text" id="invoiceNoInput" placeholder="Type Invoice Number">
        </div>
        <div class="mb-2">
            <!-- ইনপুট বক্সের টাইপ "date" রাখা হয়েছে -->
            <label class="block text-gray-700 font-bold mb-1">Invoice Date:</label>
            <input type="date" id="invoiceDateInput">
        </div>
        
        <!-- Table Content section with individual labels and inputs -->
        <h3 class="text-lg font-bold mt-4 mb-2">Table Content</h3>
        <div class="mb-2">
            <label class="block text-gray-700 font-bold mb-1">Booking For:</label>
            <!-- Pre-filled with "UMRAH" as requested -->
            <input type="text" id="bookingInput" value="UMRAH" placeholder="Booking For">
        </div>

        <!-- New Month and Year Select fields -->
        <div class="mb-2">
            <label class="block text-gray-700 font-bold mb-1">Time:</label>
            <div class="flex space-x-2">
                <div class="flex-1">
                    <select id="monthSelect">
                        <option value="" disabled selected>MONTH</option>
                        <!-- Options populated by JS -->
                    </select>
                </div>
                <div class="flex-1">
                    <select id="yearSelect">
                        <option value="" disabled selected>YEAR</option>
                        <!-- Options populated by JS -->
                    </select>
                </div>
            </div>
        </div>

        <div class="mb-2">
            <label class="block text-gray-700 font-bold mb-1">Rate:</label>
            <input type="text" id="rateInput" placeholder="Rate">
        </div>
        <div class="mb-2">
            <label class="block text-gray-700 font-bold mb-1">Unit:</label>
            <input type="text" id="unitInput" placeholder="Unit">
        </div>
        <div class="mt-4">
            <label class="block text-gray-700 font-bold mb-1">Amount Paid:</label>
            <input type="text" id="amountPaidInput" placeholder="Amount Paid">
        </div>
        
        <!-- Customer section with new input and button -->
        <div class="mt-4">
            <label class="block text-gray-700 font-bold mb-1">Customer's Name:</label>
            <input type="text" id="customerNameInput" placeholder="Type Name">
            <button id="addCustomerButton" class="add-customer-button">Add Customer</button>
        </div>

        <!-- Dynamic customer list -->
        <div class="mt-4">
            <label class="block text-gray-700 font-bold mb-1">Customer List:</label>
            <div id="customerList">
                <!-- Customers will be added here dynamically -->
            </div>
        </div>

        <!-- Payment method checkboxes section with corrected alignment -->
        <div class="mt-4">
            <label class="block text-gray-700 font-bold mb-2">Payment Method Checkboxes:</label>
            <!-- New flexbox layout to match the main invoice form's style -->
            <div class="flex space-x-4 mt-2">
                <div class="flex flex-col space-y-2">
                    <div class="flex items-center">
                        <input type="checkbox" id="cashCheckbox" class="h-4 w-4 payment-checkbox">
                        <label for="cashCheckbox" class="ml-2">Cash</label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="upiCheckbox" class="h-4 w-4 payment-checkbox">
                        <label for="upiCheckbox" class="ml-2">UPI</label>
                    </div>
                </div>
                <div class="flex flex-col space-y-2">
                    <div class="flex items-center">
                        <input type="checkbox" id="accountCheckbox" class="h-4 w-4 payment-checkbox">
                        <label for="accountCheckbox" class="ml-2">Account</label>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="chequeCheckbox" class="h-4 w-4 payment-checkbox">
                        <label for="chequeCheckbox" class="ml-2">Cheque</label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Print Button -->
        <button id="printButton" class="print-button">Print Invoice</button>
    </div>
    
    <!-- A4 Form Container -->
    <div class="a4-container shadow-lg rounded-lg">
        <!-- Top Image Section with Money Receipt text aligned using flexbox -->
        <div class="top-image-container">
            <img src="https://lh3.googleusercontent.com/pw/AP1GczP-nVNgVK20SaA9VE440rrSdD-iluAmeoH9G1b0CiFXm78y36tce3SQ8rkkWSfnb01c7Ab3Dnd83uG1nnlqbHkv3VNuHfL_MSNg862bluA0n0-DdjaTJhLojQxEq2DYnG0a0pUFzZK4_DLi5E8pzIfU=w1240-h208-s-no-gm?authuser=0" alt="Top of the invoice" class="top-image">
            <div class="money-receipt-text">
                <span id="moneyReceipt" class="font-bold text-3xl">MONEY RECEIPT</span>
            </div>
        </div>

        <!-- Invoice Details Section -->
        <div class="invoice-content relative">
            <div class="flex justify-between items-start mb-6 flex-shrink-0">
                <!-- Left Section -->
                <div class="w-1/2">
                    <p class="text-blue-600 text-lg font-bold">INVOICE TO.</p>
                    <!-- Updated color for the name field -->
                    <p id="invoiceToName" class="font-bold text-[#125b03] text-xl mt-1"></p>
                    <p class="mt-2 text-blue-600">Phone: <span id="invoiceToPhone" class="text-black ml-1"></span></p>
                    <p class="text-blue-600">Email: <span id="invoiceToEmail" class="text-black ml-1"></span></p>
                    <p class="text-blue-600">Address: <span id="invoiceToAddress" class="text-black ml-1"></span></p>
                </div>

                <!-- Right Section -->
                <div class="w-1/2 flex flex-col items-end">
                    <p class="text-blue-600">Invoice No: <span id="invoiceNo" class="text-black font-normal ml-1"></span></p>
                    <p class="text-blue-600 mt-2">Invoice Date: <span id="invoiceDate" class="text-black font-normal ml-1"></span></p>
                    <p class="text-blue-600 font-bold mt-4">PAYMENT METHOD</p>
                    <div class="flex space-x-4 mt-2">
                        <div class="flex flex-col space-y-2">
                            <div class="flex items-center">
                                <!-- The text color of the tick will be updated by JS -->
                                <span id="cashBox" class="w-4 h-4 border border-black mr-2 text-center text-sm font-bold"></span>
                                <span class="text-black">Cash</span>
                            </div>
                            <div class="flex items-center">
                                <!-- The text color of the tick will be updated by JS -->
                                <span id="upiBox" class="w-4 h-4 border border-black mr-2 text-center text-sm font-bold"></span>
                                <span class="text-black">UPI</span>
                            </div>
                        </div>
                        <div class="flex flex-col space-y-2">
                            <div class="flex items-center">
                                <!-- The text color of the tick will be updated by JS -->
                                <span id="accountBox" class="w-4 h-4 border border-black mr-2 text-center text-sm font-bold"></span>
                                <span class="text-black">Account</span>
                            </div>
                            <div class="flex items-center">
                                <!-- The text color of the tick will be updated by JS -->
                                <span id="chequeBox" class="w-4 h-4 border border-black mr-2 text-center text-sm font-bold"></span>
                                <span class="text-black">Cheque</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Watermark Layer (Now as a sibling to the table, but within the relative parent) -->
            <img src="https://lh3.googleusercontent.com/pw/AP1GczObm7bQ6s9CmzxkctALvk2osGPajcBDYy4MwbsrjKQ80fCionvx572F_6OIfcAhpXyUwkyxqI-6K6L1xRgsXvzQM5zOR510Dz09JGRGG4qrZwdGa1Rfg3J1e_nBP71R1n5eARFFOligq9Db9blXalCO=w1209-h945-s-no-gm?authuser=0" alt="Watermark Logo" class="watermark-image">

            <!-- Table Section. Fixed height of 400px as requested by the user. -->
            <div class="border border-blue-600 rounded-lg mt-4 relative z-10 flex flex-col h-[400px]">
                <!-- Table Content Layer -->
                <div class="flex flex-col flex-grow">
                    <!-- Table Header - New grid layout with 4 columns -->
                    <div class="grid grid-cols-[1fr_2fr_1fr_1fr] bg-blue-600 text-white font-bold text-center grid-header border-b border-blue-600 flex-shrink-0">
                        <div class="p-2 border-r border-blue-400">BOOKING FOR</div>
                        <div class="p-2 border-r border-blue-400">DESCRIPTION</div>
                        <div class="p-2 border-r border-blue-400">UNIT</div>
                        <div class="p-2">AMOUNT</div>
                    </div>
                    
                    <!-- Main Content Row - Now flex-grow to absorb the empty space -->
                    <div class="grid grid-cols-[1fr_2fr_1fr_1fr] text-black text-center flex-grow">
                        <!-- The height of this row will now expand dynamically -->
                        <div id="bookingCell" class="p-2 border-r border-blue-600 text-center"></div>
                        <div id="descCell" class="p-2 border-r border-blue-600 text-center"></div>
                        <div id="unitCell" class="p-2 border-r border-blue-600 text-center"></div>
                        <div id="amountCell" class="p-2 text-center"></div>
                    </div>
                    
                    <!-- Amount Paid Row - flex-shrink-0 to not shrink -->
                    <div class="grid grid-cols-[1fr_2fr_1fr_1fr] text-black text-center flex-shrink-0">
                        <div class="p-2 border-r border-blue-600"></div>
                        <div class="p-2 border-r border-blue-600"></div>
                        <div class="p-2 border-r border-blue-600 font-bold text-[#094ea0] text-center border-t border-b border-blue-600">Amount Paid</div>
                        <div id="amountPaidCell" class="p-2 font-bold text-center border-t border-b border-blue-600"></div>
                    </div>
                    
                    <!-- Due Amount Row - flex-shrink-0 to not shrink -->
                    <div class="grid grid-cols-[1fr_2fr_1fr_1fr] text-black text-center flex-shrink-0">
                        <div class="p-2 border-r border-blue-600"></div>
                        <div class="p-2 border-r border-blue-600"></div>
                        <div class="p-2 border-r border-blue-600 font-bold text-red-600 text-center">Due Amount</div>
                        <div id="dueAmountCell" class="p-2 font-bold text-red-600 text-center"></div>
                    </div>
                </div>
            </div>

            <!-- Customer names section is now directly below the table, with no top margin. -->
            <div class="flex flex-col justify-start text-left mt-0 flex-shrink-0">
                <p class="text-blue-600 font-bold underline">Customer's Name</p>
                <!-- This is the new container for the two-column layout -->
                <div class="customer-names-display" id="customerNamesOnForm">
                    <!-- The two columns will be rendered here by JavaScript -->
                    <div id="firstColumn"></div>
                    <div id="secondColumn"></div>
                </div>
            </div>
        </div>
        
        <!-- Bottom section with stamp and signature, now using flexbox -->
        <div class="bottom-section">
            <!-- This container now aligns the stamp and signature, linking their positions -->
            <div class="merged-elements flex justify-between items-end w-full px-6">
                <!-- New container to center the stamp -->
                <div class="stamp-container">
                    <img src="https://lh3.googleusercontent.com/pw/AP1GczOoRXgeZYru-nFUkeZWEXHXCykyGLwYrszY4w1U9BxHGpHa2bK3iTxuSS32hw3cTKF_s_kqFI3kNSCK3mkoILty5AgB0Og5LhH_jYs3VO_ZodLDwKjS1woRGP7T6lYwqwv1YOd80nRk9Hq3VX5lAZcT=w945-h945-s-no-gm?authuser=0" alt="Official Stamp" class="stamp-image">
                </div>

                <!-- Name & Signature part -->
                <div class="signature-section">
                    <div class="border-b border-black w-48 h-12 mb-2"></div>
                    <p class="font-bold text-black">Name & Signature</p>
                </div>
            </div>

            <!-- Bottom Image Section - positioned below the merged elements -->
            <img src="https://lh3.googleusercontent.com/pw/AP1GczMQmhgA1CtOTSdgUi9FixF-mEFPEuMbf7d1NzL57TV8zP8OdwyNdpGLSpAdudSwkLkUbfG37Nm42NaF3JKo4NBtxfsapiMHr6QJ0eGBHrNYf5zxZyyzElGE06AjB1AK13VWgmeibWGY7L_fyeVwHF6g=w1240-h158-s-no-gm?authuser=0" alt="Bottom of the invoice" class-name="bottom-image">
        </div>
    </div>

    <script>
        const nameInput = document.getElementById('nameInput');
        const phoneInput = document.getElementById('phoneInput');
        // Updated variable to match the new input field ID
        const emailPrefixInput = document.getElementById('emailPrefixInput');
        const addressInput = document.getElementById('addressInput');
        const invoiceNoInput = document.getElementById('invoiceNoInput');
        const invoiceDateInput = document.getElementById('invoiceDateInput');
        const bookingInput = document.getElementById('bookingInput');
        const monthSelect = document.getElementById('monthSelect');
        const yearSelect = document.getElementById('yearSelect');
        const rateInput = document.getElementById('rateInput');
        const unitInput = document.getElementById('unitInput');
        const amountPaidInput = document.getElementById('amountPaidInput');
        const customerNameInput = document.getElementById('customerNameInput');
        const printButton = document.getElementById('printButton');
        const addCustomerButton = document.getElementById('addCustomerButton');
        const customerList = document.getElementById('customerList');
        
        // New elements for the two-column display
        const firstColumn = document.getElementById('firstColumn');
        const secondColumn = document.getElementById('secondColumn');

        // Payment method checkboxes
        const cashCheckbox = document.getElementById('cashCheckbox');
        const accountCheckbox = document.getElementById('accountCheckbox');
        const upiCheckbox = document.getElementById('upiCheckbox');
        const chequeCheckbox = document.getElementById('chequeCheckbox');

        const invoiceToName = document.getElementById('invoiceToName');
        const invoiceToPhone = document.getElementById('invoiceToPhone');
        const invoiceToEmail = document.getElementById('invoiceToEmail');
        const invoiceToAddress = document.getElementById('invoiceToAddress');
        const invoiceNo = document.getElementById('invoiceNo');
        const invoiceDate = document.getElementById('invoiceDate');
        
        const bookingCell = document.getElementById('bookingCell');
        const descCell = document.getElementById('descCell');
        const unitCell = document.getElementById('unitCell');
        const amountCell = document.getElementById('amountCell');

        const amountPaidCell = document.getElementById('amountPaidCell');
        const dueAmountCell = document.getElementById('dueAmountCell');

        // Payment method display boxes
        const cashBox = document.getElementById('cashBox');
        const accountBox = document.getElementById('accountBox');
        const upiBox = document.getElementById('upiBox');
        const chequeBox = document.getElementById('chequeBox');

        // A list of all focusable input elements in the desired order
        const focusableElements = [
            nameInput,
            phoneInput,
            emailPrefixInput,
            addressInput,
            invoiceNoInput,
            invoiceDateInput,
            bookingInput,
            monthSelect,
            yearSelect,
            rateInput,
            unitInput,
            amountPaidInput,
            customerNameInput,
            // Added payment method checkboxes to the navigation list
            cashCheckbox,
            upiCheckbox,
            accountCheckbox,
            chequeCheckbox
        ];
        
        // Add event listeners for the 'keydown' event to all focusable elements
        focusableElements.forEach(input => {
            input.addEventListener('keydown', (event) => {
                const currentIndex = focusableElements.indexOf(event.target);
                
                // If the pressed key is 'ArrowDown'
                if (event.key === 'ArrowDown') {
                    event.preventDefault(); // Prevent default browser behavior (like page scrolling)

                    // Find the next element in the list
                    const nextIndex = currentIndex + 1;
                    if (nextIndex < focusableElements.length) {
                        focusableElements[nextIndex].focus();
                    }
                }
                // If the pressed key is 'ArrowUp'
                else if (event.key === 'ArrowUp') {
                    event.preventDefault(); // Prevent default browser behavior
                    const previousIndex = currentIndex - 1;
                    // If there's a previous element, focus it
                    if (previousIndex >= 0) {
                        focusableElements[previousIndex].focus();
                    }
                }
                // If the pressed key is 'Enter' on the customerNameInput field
                else if (event.key === 'Enter' && event.target.id === 'customerNameInput') {
                    event.preventDefault(); // Prevent form submission
                    addCustomerButton.click(); // Simulate a click on the "Add Customer" button
                }
                // New logic: If the pressed key is 'Enter' and the target is a checkbox
                else if (event.key === 'Enter' && event.target.type === 'checkbox') {
                    event.preventDefault();
                    event.target.checked = !event.target.checked; // Toggle the checked state
                    updatePaymentMethod(); // Update the display to reflect the change
                }
            });
        });
        
        // **NEW LOGIC: Focus on the first input if nothing is focused and down arrow is pressed**
        document.addEventListener('keydown', (event) => {
            if (event.key === 'ArrowDown') {
                // Check if the currently active element is not a form control or is the body itself
                const activeElement = document.activeElement;
                const isInputFocused = focusableElements.includes(activeElement);
                
                if (!isInputFocused) {
                    nameInput.focus();
                    event.preventDefault(); // Prevent page from scrolling
                }
            }
        });


        /**
         * Indian Currency Formatter Function
         * This function takes a number and formats it with commas according.
         * For example: 100000 -> 1,00,000
         * @param {number} number The number to format.
         * @returns {string} The formatted string with commas and the "/-" suffix.
         */
        function formatIndianCurrency(number) {
            // Check if the number is valid. If not, return "0/-"
            if (isNaN(number)) {
                return "0/-";
            }
            // Use Intl.NumberFormat to get the correct Indian locale formatting.
            const formatter = new Intl.NumberFormat('en-IN', {
                minimumFractionDigits: 0,
                maximumFractionDigits: 2
            });
            return `${formatter.format(number)}/-`;
        }

        // Function to populate the month and year select fields
        function populateSelects() {
            const months = ["JANUARY", "FEBRUARY", "MARCH", "APRIL", "MAY", "JUNE", "JULY", "AUGUST", "SEPTEMBER", "OCTOBER", "NOVEMBER", "DECEMBER"];
            const monthOptions = months.map(month => `<option value="${month}">${month}</option>`).join('');
            monthSelect.innerHTML += monthOptions;

            const currentYear = new Date().getFullYear();
            let yearOptions = '';
            for (let i = 2025; i <= 2035; i++) {
                yearOptions += `<option value="${i}">${i}</option>`;
            }
            yearSelect.innerHTML += yearOptions;
        }

        // Function to update the main form fields based on input values and perform calculations
        function updateForm() {
            // Update personal details, converting to uppercase (except email)
            invoiceToName.textContent = nameInput.value.toUpperCase();
            invoiceToPhone.textContent = phoneInput.value.toUpperCase();
            // BEGIN: Updated logic for the Email field
            const emailPrefix = emailPrefixInput.value.trim();
            if (emailPrefix) {
                invoiceToEmail.textContent = emailPrefix + '@gmail.com';
            } else {
                invoiceToEmail.textContent = '';
            }
            // END: Updated logic for the Email field
            invoiceToAddress.textContent = addressInput.value.toUpperCase();
            
            // ইনপুট বক্সের তারিখ yyyy-mm-dd ফরম্যাটে আসবে, তাই একে dd/mm/yyyy তে পরিবর্তন করা হচ্ছে
            const dateValue = invoiceDateInput.value;
            if (dateValue) {
                const [year, month, day] = dateValue.split('-');
                invoiceDate.textContent = `${day}/${month}/${year}`;
            } else {
                invoiceDate.textContent = '';
            }
            
            // Generate the complex invoice number
            const selectedMonth = monthSelect.value;
            const selectedYear = yearSelect.value;
            const invoiceNumberPart = invoiceNoInput.value;
            
            let fullInvoiceNumber = '';
            if (selectedMonth && selectedYear && invoiceNumberPart) {
                const monthShort = selectedMonth.substring(0, 3).toUpperCase();
                const yearShort = selectedYear.substring(2);
                fullInvoiceNumber = `NIT/${monthShort}${yearShort}/${invoiceNumberPart}`;
            }
            invoiceNo.textContent = fullInvoiceNumber;

            // Set the booking and unit cells directly
            bookingCell.textContent = bookingInput.value.toUpperCase();
            unitCell.textContent = unitInput.value.toUpperCase();

            // Get selected month and year values
            const timeText = (selectedMonth && selectedYear) ? `(${selectedMonth} ${selectedYear})` : '';

            // Update the description cell with multiple lines
            const bookingText = bookingInput.value.trim() ? bookingInput.value.trim().toUpperCase() : '';
            const rateValue = parseFloat(rateInput.value);
            const rateText = !isNaN(rateValue) ? `${formatIndianCurrency(rateValue)} PER PERSON` : '';
            
            // Construct the HTML for the description cell with line breaks
            descCell.innerHTML = `
                ${bookingText}
                <br>${timeText}
                <br>${rateText}
            `;

            // Calculate the total amount
            const unitValue = parseFloat(unitInput.value);
            let totalAmount = 0;
            if (!isNaN(rateValue) && !isNaN(unitValue)) {
                totalAmount = rateValue * unitValue;
            }
            // ফরম্যাটিং ফাংশন ব্যবহার করে মোট পরিমাণ আপডেট করা হচ্ছে
            amountCell.textContent = formatIndianCurrency(totalAmount);
            
            // Calculate the due amount
            const amountPaidValue = parseFloat(amountPaidInput.value);
            let dueAmount = totalAmount;
            if (!isNaN(amountPaidValue)) {
                dueAmount = totalAmount - amountPaidValue;
            }
            // ফরম্যাটিং ফাংশন ব্যবহার করে প্রদান করা পরিমাণ আপডেট করা হচ্ছে
            amountPaidCell.textContent = formatIndianCurrency(amountPaidValue || 0);
            // ফরম্যাটিং ফাংশন ব্যবহার করে বাকি পরিমাণ আপডেট করা হচ্ছে
            dueAmountCell.textContent = formatIndianCurrency(dueAmount);
        }

        // Function to update the customer names on the form and split them into two columns
        function updateFormCustomerNames() {
            // Clear existing names from both columns
            firstColumn.innerHTML = '';
            secondColumn.innerHTML = '';
            
            // Select only the spans with the customer name, not the delete button
            const customerItems = customerList.querySelectorAll('.customer-item .customer-name-text');
            
            // Add each customer name to the correct column with a maximum of 4 per column
            customerItems.forEach((item, index) => {
                const p = document.createElement('p');
                // The name is a numbered list item
                p.textContent = `${index + 1}. ${item.textContent.toUpperCase()}`;
                p.className = 'text-black mb-1';
                
                // If index is less than 4 (0, 1, 2, 3), add to the first column
                if (index < 4) {
                    firstColumn.appendChild(p);
                } 
                // If index is 4 or greater, add to the second column
                else {
                    secondColumn.appendChild(p);
                }
            });
        }

        // Function to update the payment method boxes based on checkbox state
        function updatePaymentMethod() {
            // The color to use for the checkmark, matching the INVOICE TO name color.
            const tickColor = '#125b03';

            // Update Cash checkbox
            if (cashCheckbox.checked) {
                cashBox.textContent = '✓';
                cashBox.style.color = tickColor;
            } else {
                cashBox.textContent = '';
                cashBox.style.color = '';
            }

            // Update UPI checkbox
            if (upiCheckbox.checked) {
                upiBox.textContent = '✓';
                upiBox.style.color = tickColor;
            } else {
                upiBox.textContent = '';
                upiBox.style.color = '';
            }
            
            // Update Account checkbox
            if (accountCheckbox.checked) {
                accountBox.textContent = '✓';
                accountBox.style.color = tickColor;
            } else {
                accountBox.textContent = '';
                accountBox.style.color = '';
            }

            // Update Cheque checkbox
            if (chequeCheckbox.checked) {
                chequeBox.textContent = '✓';
                chequeBox.style.color = tickColor;
            } else {
                chequeBox.textContent = '';
                chequeBox.style.color = '';
            }
        }
        
        // Add a customer to the list
        addCustomerButton.addEventListener('click', () => {
            // Check if the maximum number of customers (8) has been reached
            if (customerList.children.length >= 8) {
                console.log("Maximum number of customers (8) reached. Cannot add more.");
                // You could also disable the button or show a message to the user here.
                return;
            }

            const newCustomerName = customerNameInput.value.trim();
            if (newCustomerName) {
                // Create a new div element for the customer with a delete button
                const customerItem = document.createElement('div');
                customerItem.className = 'customer-item';
                
                // Create a span for the name with a specific class
                const nameSpan = document.createElement('span');
                nameSpan.className = 'customer-name-text';
                nameSpan.textContent = newCustomerName;
                
                const deleteBtn = document.createElement('span');
                deleteBtn.className = 'delete-btn';
                deleteBtn.textContent = '✖';

                // Add a click listener to delete the item
                deleteBtn.addEventListener('click', (event) => {
                    event.stopPropagation();
                    customerList.removeChild(customerItem);
                    updateFormCustomerNames();
                });
                
                // Add a click listener to set this name on the form (for single selection)
                customerItem.addEventListener('click', () => {
                    // You can add logic here to highlight the selected name if needed
                });

                customerItem.appendChild(nameSpan);
                customerItem.appendChild(deleteBtn);
                
                // Append the new customer to the list
                customerList.appendChild(customerItem);
                
                // Clear the input field and update the form
                customerNameInput.value = '';
                updateFormCustomerNames();
            }
        });

        // Add event listeners to all input fields
        nameInput.addEventListener('input', updateForm);
        phoneInput.addEventListener('input', updateForm);
        // Updated event listener for the new email input
        emailPrefixInput.addEventListener('input', updateForm);
        addressInput.addEventListener('input', updateForm);
        invoiceNoInput.addEventListener('input', updateForm);
        // "change" ইভেন্ট ব্যবহার করা হয়েছে যাতে ইনপুট বক্সের ভ্যালু পরিবর্তন হলেই ফর্ম আপডেট হয়
        invoiceDateInput.addEventListener('change', updateForm);
        bookingInput.addEventListener('input', updateForm);
        rateInput.addEventListener('input', updateForm);
        unitInput.addEventListener('input', updateForm);
        amountPaidInput.addEventListener('input', updateForm);
        customerNameInput.addEventListener('input', updateForm);
        
        // Add event listeners to new select fields
        monthSelect.addEventListener('change', updateForm);
        yearSelect.addEventListener('change', updateForm);

        // Add event listeners to payment method checkboxes
        cashCheckbox.addEventListener('change', updatePaymentMethod);
        accountCheckbox.addEventListener('change', updatePaymentMethod);
        upiCheckbox.addEventListener('change', updatePaymentMethod);
        chequeCheckbox.addEventListener('change', updatePaymentMethod);

        // Add event listener for the print button
        printButton.addEventListener('click', () => {
            window.print();
        });

        // Initial setup on page load
        populateSelects();
        updateFormCustomerNames();
        // Initial call to update form values based on pre-filled data
        updateForm();
    </script>
</body>
</html>
